'use strict';

var semver = require('semver');

if (!semver.satisfies(process.version, '>=6.0.0')) {
  require('babel-polyfill');
}

var Promise = require('bluebird');
var _ = require('lodash');
var path = require('path');

var dseDriver = void 0;
try {
  // eslint-disable-next-line import/no-extraneous-dependencies, import/no-unresolved
  dseDriver = require('dse-driver');
} catch (e) {
  dseDriver = null;
}

var cql = Promise.promisifyAll(dseDriver || require('cassandra-driver'));

var ORM = Promise.promisifyAll(require('./orm/apollo'));
var readdirpAsync = Promise.promisify(require('readdirp'));
var debug = require('debug')('express-cassandra');

var exporter = require('./utils/exporter');
var importer = require('./utils/importer');

var CassandraClient = function f(options) {
  this.modelInstance = {};
  this.orm = new ORM(options.clientOptions, options.ormOptions);
  this.orm = Promise.promisifyAll(this.orm);
};

CassandraClient.createClient = function (options) {
  return new CassandraClient(options);
};

CassandraClient.setDirectory = function (directory) {
  CassandraClient.directory = directory;
  return CassandraClient;
};

CassandraClient.syncModelFileToDB = function (file, callback) {
  if (!file.name.includes('Model')) {
    callback();
    return;
  }

  var modelName = CassandraClient._translateFileNameToModelName(file.name);

  if (modelName) {
    var fileLocation = path.join(CassandraClient.directory, file.path);
    // eslint-disable-next-line import/no-dynamic-require
    var defaultModelSchema = require(fileLocation);
    var modelSchema = defaultModelSchema.default ? defaultModelSchema.default : defaultModelSchema;
    CassandraClient.modelInstance[modelName] = CassandraClient.orm.addModel(modelName.toLowerCase(), modelSchema);
    CassandraClient.modelInstance[modelName].syncDB(callback);
    CassandraClient.modelInstance[modelName] = Promise.promisifyAll(CassandraClient.modelInstance[modelName]);
    return;
  }

  callback();
};

CassandraClient.bind = function (options, cb) {
  CassandraClient.modelInstance = {};
  CassandraClient.orm = new ORM(options.clientOptions, options.ormOptions);
  CassandraClient.orm = Promise.promisifyAll(CassandraClient.orm);
  CassandraClient.orm.initAsync().then(function () {
    return readdirpAsync({
      root: CassandraClient.directory,
      fileFilter: ['*.js', '*.javascript', '*.jsx', '*.coffee', '*.coffeescript', '*.iced', '*.script', '*.ts', '*.tsx', '*.typescript', '*.cjsx', '*.co', '*.json', '*.json5', '*.litcoffee', '*.liticed', '*.ls', '*.node', '*.toml', '*.wisp', '*.cjs']
    });
  }).then(function (fileList) {
    var syncModelTasks = [];
    var syncModelFileToDBAsync = Promise.promisify(CassandraClient.syncModelFileToDB);
    fileList = fileList.files;
    fileList.forEach(function (file) {
      syncModelTasks.push(syncModelFileToDBAsync(file));
    });
    return Promise.all(syncModelTasks);
  }).then(function () {
    if (cb) cb();
  }).catch(function (err) {
    if (cb && _.isArray(err) && err.length > 0) cb(err[0]);else if (cb) cb(err);
  });
};

CassandraClient.bindAsync = Promise.promisify(CassandraClient.bind);

CassandraClient.prototype.init = function f(callback) {
  this.orm.init(callback);
};

CassandraClient.prototype.initAsync = Promise.promisify(CassandraClient.prototype.init);

CassandraClient.getTableList = function f(callback) {
  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();
  var tables = [];

  systemClient.connect().then(function () {
    var systemQuery = 'SELECT table_name FROM system_schema.tables WHERE keyspace_name = ?';
    debug(`Finding tables in keyspace: ${keyspace}`);
    return systemClient.execute(systemQuery, [keyspace]);
  }).then(function (result) {
    for (var i = 0; i < result.rows.length; i++) {
      tables.push(result.rows[i].table_name);
    }
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    callback(null, tables);
  }).catch(function (err) {
    callback(err);
  });
};

CassandraClient.getTableListAsync = Promise.promisify(CassandraClient.getTableList);

CassandraClient.export = function f(fixtureDirectory, callback) {
  var _this = this;

  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();

  systemClient.connect().then(function () {
    return _this.getTableListAsync();
  }).then(function (tables) {
    return Promise.each(tables, function (table) {
      return exporter.processTableExport(systemClient, fixtureDirectory, keyspace, table);
    });
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    debug('==================================================');
    debug(`Completed exporting all tables from keyspace: ${keyspace}`);
    callback();
  }).catch(function (err) {
    debug(err);
    callback(err);
  });
};

CassandraClient.exportAsync = Promise.promisify(CassandraClient.export);

CassandraClient.import = function f(fixtureDirectory, options, callback) {
  var _this2 = this;

  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    batchSize: 1
  };

  options = _.defaultsDeep({}, options, defaults);

  var systemClient = this.orm.get_system_client();
  var keyspace = this.orm.get_keyspace_name();

  systemClient.connect().then(function () {
    return _this2.getTableListAsync();
  }).then(function (tables) {
    return Promise.each(tables, function (table) {
      return importer.processTableImport(systemClient, fixtureDirectory, keyspace, table, options.batchSize);
    });
  }).then(function () {
    return systemClient.shutdown();
  }).then(function () {
    debug('==================================================');
    debug(`Completed importing to keyspace: ${keyspace}`);
    callback();
  }).catch(function (err) {
    debug(err);
    callback(err);
  });
};

CassandraClient.importAsync = Promise.promisify(CassandraClient.import);

CassandraClient.prototype.loadSchema = function f(modelName, modelSchema) {
  this.modelInstance[modelName] = this.orm.addModel(modelName, modelSchema);
  this.modelInstance[modelName] = Promise.promisifyAll(this.modelInstance[modelName]);
  return this.modelInstance[modelName];
};

CassandraClient.uuid = function () {
  return cql.types.Uuid.random();
};

CassandraClient.uuidFromString = function (str) {
  return cql.types.Uuid.fromString(str);
};

CassandraClient.uuidFromBuffer = function (buf) {
  return new cql.types.Uuid(buf);
};

CassandraClient.timeuuid = function () {
  return cql.types.TimeUuid.now();
};

CassandraClient.timeuuidFromDate = function (date) {
  return cql.types.TimeUuid.fromDate(date);
};

CassandraClient.timeuuidFromString = function (str) {
  return cql.types.TimeUuid.fromString(str);
};

CassandraClient.timeuuidFromBuffer = function (buf) {
  return new cql.types.TimeUuid(buf);
};

CassandraClient.maxTimeuuid = function (date) {
  return cql.types.TimeUuid.max(date);
};

CassandraClient.minTimeuuid = function (date) {
  return cql.types.TimeUuid.min(date);
};

CassandraClient.prototype.doBatch = function f(queries, options, callback) {
  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep({}, options, defaults);

  var randomModel = this.modelInstance[Object.keys(this.modelInstance)[0]];
  var beforeHooks = [];

  var batchResult = void 0;
  Promise.all(beforeHooks).then(function () {
    if (queries.length > 1) {
      return randomModel.execute_batchAsync(queries, options);
    }
    if (queries.length > 0) {
      debug('single query provided for batch request, applying as non batch query');
      return randomModel.execute_queryAsync(queries[0].query, queries[0].params, options);
    }
    debug('no queries provided for batch request, empty array found, doing nothing');
    return {};
  }).then(function (response) {
    batchResult = response;
    for (var i = 0; i < queries.length; i++) {
      var afterHookResponse = queries[i].after_hook();
      if (afterHookResponse !== true) {
        callback(afterHookResponse);
        return;
      }
    }
    callback(null, batchResult);
  }).catch(function (err) {
    callback(err);
  });
};

CassandraClient.prototype.doBatchAsync = Promise.promisify(CassandraClient.prototype.doBatch);

CassandraClient.doBatch = function f(queries, options, callback) {
  if (arguments.length === 2) {
    callback = options;
    options = {};
  }

  var defaults = {
    prepare: true
  };

  options = _.defaultsDeep({}, options, defaults);

  CassandraClient.prototype.doBatch.call(CassandraClient, queries, options, callback);
};

CassandraClient.doBatchAsync = Promise.promisify(CassandraClient.doBatch);

CassandraClient._translateFileNameToModelName = function (fileName) {
  return fileName.slice(0, fileName.lastIndexOf('.')).replace('Model', '');
};

Object.defineProperties(CassandraClient, {
  consistencies: {
    get() {
      return cql.types.consistencies;
    }
  },
  datatypes: {
    get() {
      return cql.types;
    }
  },
  driver: {
    get() {
      return cql;
    }
  },
  instance: {
    get() {
      return CassandraClient.modelInstance;
    }
  },
  close: {
    get() {
      return CassandraClient.orm.close;
    }
  },
  closeAsync: {
    get() {
      return Promise.promisify(CassandraClient.orm.close);
    }
  }
});

Object.defineProperties(CassandraClient.prototype, {
  consistencies: {
    get() {
      return cql.types.consistencies;
    }
  },
  datatypes: {
    get() {
      return cql.types;
    }
  },
  driver: {
    get() {
      return cql;
    }
  },
  instance: {
    get() {
      return this.modelInstance;
    }
  },
  close: {
    get() {
      return this.orm.close;
    }
  },
  closeAsync: {
    get() {
      return Promise.promisify(this.orm.close);
    }
  }
});

CassandraClient.prototype.uuid = CassandraClient.uuid;
CassandraClient.prototype.uuidFromString = CassandraClient.uuidFromString;
CassandraClient.prototype.uuidFromBuffer = CassandraClient.uuidFromBuffer;
CassandraClient.prototype.timeuuid = CassandraClient.timeuuid;
CassandraClient.prototype.timeuuidFromDate = CassandraClient.timeuuidFromDate;
CassandraClient.prototype.timeuuidFromString = CassandraClient.timeuuidFromString;
CassandraClient.prototype.timeuuidFromBuffer = CassandraClient.timeuuidFromBuffer;
CassandraClient.prototype.maxTimeuuid = CassandraClient.maxTimeuuid;
CassandraClient.prototype.minTimeuuid = CassandraClient.minTimeuuid;

CassandraClient.prototype._translateFileNameToModelName = CassandraClient._translateFileNameToModelName;

module.exports = CassandraClient;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9leHByZXNzQ2Fzc2FuZHJhLmpzIl0sIm5hbWVzIjpbInNlbXZlciIsInJlcXVpcmUiLCJzYXRpc2ZpZXMiLCJwcm9jZXNzIiwidmVyc2lvbiIsIlByb21pc2UiLCJfIiwicGF0aCIsImRzZURyaXZlciIsImUiLCJjcWwiLCJwcm9taXNpZnlBbGwiLCJPUk0iLCJyZWFkZGlycEFzeW5jIiwicHJvbWlzaWZ5IiwiZGVidWciLCJleHBvcnRlciIsImltcG9ydGVyIiwiQ2Fzc2FuZHJhQ2xpZW50IiwiZiIsIm9wdGlvbnMiLCJtb2RlbEluc3RhbmNlIiwib3JtIiwiY2xpZW50T3B0aW9ucyIsIm9ybU9wdGlvbnMiLCJjcmVhdGVDbGllbnQiLCJzZXREaXJlY3RvcnkiLCJkaXJlY3RvcnkiLCJzeW5jTW9kZWxGaWxlVG9EQiIsImZpbGUiLCJjYWxsYmFjayIsIm5hbWUiLCJpbmNsdWRlcyIsIm1vZGVsTmFtZSIsIl90cmFuc2xhdGVGaWxlTmFtZVRvTW9kZWxOYW1lIiwiZmlsZUxvY2F0aW9uIiwiam9pbiIsImRlZmF1bHRNb2RlbFNjaGVtYSIsIm1vZGVsU2NoZW1hIiwiZGVmYXVsdCIsImFkZE1vZGVsIiwidG9Mb3dlckNhc2UiLCJzeW5jREIiLCJiaW5kIiwiY2IiLCJpbml0QXN5bmMiLCJ0aGVuIiwicm9vdCIsImZpbGVGaWx0ZXIiLCJmaWxlTGlzdCIsInN5bmNNb2RlbFRhc2tzIiwic3luY01vZGVsRmlsZVRvREJBc3luYyIsImZpbGVzIiwiZm9yRWFjaCIsInB1c2giLCJhbGwiLCJjYXRjaCIsImVyciIsImlzQXJyYXkiLCJsZW5ndGgiLCJiaW5kQXN5bmMiLCJwcm90b3R5cGUiLCJpbml0IiwiZ2V0VGFibGVMaXN0Iiwic3lzdGVtQ2xpZW50IiwiZ2V0X3N5c3RlbV9jbGllbnQiLCJrZXlzcGFjZSIsImdldF9rZXlzcGFjZV9uYW1lIiwidGFibGVzIiwiY29ubmVjdCIsInN5c3RlbVF1ZXJ5IiwiZXhlY3V0ZSIsInJlc3VsdCIsImkiLCJyb3dzIiwidGFibGVfbmFtZSIsInNodXRkb3duIiwiZ2V0VGFibGVMaXN0QXN5bmMiLCJleHBvcnQiLCJmaXh0dXJlRGlyZWN0b3J5IiwiZWFjaCIsInRhYmxlIiwicHJvY2Vzc1RhYmxlRXhwb3J0IiwiZXhwb3J0QXN5bmMiLCJpbXBvcnQiLCJhcmd1bWVudHMiLCJkZWZhdWx0cyIsImJhdGNoU2l6ZSIsImRlZmF1bHRzRGVlcCIsInByb2Nlc3NUYWJsZUltcG9ydCIsImltcG9ydEFzeW5jIiwibG9hZFNjaGVtYSIsInV1aWQiLCJ0eXBlcyIsIlV1aWQiLCJyYW5kb20iLCJ1dWlkRnJvbVN0cmluZyIsInN0ciIsImZyb21TdHJpbmciLCJ1dWlkRnJvbUJ1ZmZlciIsImJ1ZiIsInRpbWV1dWlkIiwiVGltZVV1aWQiLCJub3ciLCJ0aW1ldXVpZEZyb21EYXRlIiwiZGF0ZSIsImZyb21EYXRlIiwidGltZXV1aWRGcm9tU3RyaW5nIiwidGltZXV1aWRGcm9tQnVmZmVyIiwibWF4VGltZXV1aWQiLCJtYXgiLCJtaW5UaW1ldXVpZCIsIm1pbiIsImRvQmF0Y2giLCJxdWVyaWVzIiwicHJlcGFyZSIsInJhbmRvbU1vZGVsIiwiT2JqZWN0Iiwia2V5cyIsImJlZm9yZUhvb2tzIiwiYmF0Y2hSZXN1bHQiLCJleGVjdXRlX2JhdGNoQXN5bmMiLCJleGVjdXRlX3F1ZXJ5QXN5bmMiLCJxdWVyeSIsInBhcmFtcyIsInJlc3BvbnNlIiwiYWZ0ZXJIb29rUmVzcG9uc2UiLCJhZnRlcl9ob29rIiwiZG9CYXRjaEFzeW5jIiwiY2FsbCIsImZpbGVOYW1lIiwic2xpY2UiLCJsYXN0SW5kZXhPZiIsInJlcGxhY2UiLCJkZWZpbmVQcm9wZXJ0aWVzIiwiY29uc2lzdGVuY2llcyIsImdldCIsImRhdGF0eXBlcyIsImRyaXZlciIsImluc3RhbmNlIiwiY2xvc2UiLCJjbG9zZUFzeW5jIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNQSxTQUFTQyxRQUFRLFFBQVIsQ0FBZjs7QUFFQSxJQUFJLENB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MUUsZ0JBQWdCMkMsU0FBaEIsQ0FBMEJtQyxjQUExQixHQUEyQzlFLGdCQUFnQjhFLGNBQTNEO0FBQ0E5RSxnQkFBZ0IyQyxTQUFoQixDQUEwQnNDLGNBQTFCLEdBQTJDakYsZ0JBQWdCaUYsY0FBM0Q7QUFDQWpGLGdCQUFnQjJDLFNBQWhCLENBQTBCd0MsUUFBMUIsR0FBcUNuRixnQkFBZ0JtRixRQUFyRDtBQUNBbkYsZ0JBQWdCMkMsU0FBaEIsQ0FBMEIyQyxnQkFBMUIsR0FBNkN0RixnQkFBZ0JzRixnQkFBN0Q7QUFDQXRGLGdCQUFnQjJDLFNBQWhCLENBQTBCOEMsa0JBQTFCLEdBQStDekYsZ0JBQWdCeUYsa0JBQS9EO0FBQ0F6RixnQkFBZ0IyQyxTQUFoQixDQUEwQitDLGtCQUExQixHQUErQzFGLGdCQUFnQjBGLGtCQUEvRDtBQUNBMUYsZ0JBQWdCMkMsU0FBaEIsQ0FBMEJnRCxXQUExQixHQUF3QzNGLGdCQUFnQjJGLFdBQXhEO0FBQ0EzRixnQkFBZ0IyQyxTQUFoQixDQUEwQmtELFdBQTFCLEdBQXdDN0YsZ0JBQWdCNkYsV0FBeEQ7O0FBRUE3RixnQkFBZ0IyQyxTQUFoQixDQUEwQjNCLDZCQUExQixHQUEwRGhCLGdCQUFnQmdCLDZCQUExRTs7QUFFQTRHLE9BQU9DLE9BQVAsR0FBaUI3SCxlQUFqQiIsImZpbGUiOiJleHByZXNzQ2Fzc2FuZHJhLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2VtdmVyID0gcmVxdWlyZSgnc2VtdmVyJyk7XG5cbmlmICghc2VtdmVyLnNhdGlzZmllcyhwcm9jZXNzLnZlcnNpb24sICc+PTYuMC4wJykpIHtcbiAgcmVxdWlyZSgnYmFiZWwtcG9seWZpbGwnKTtcbn1cblxuY29uc3QgUHJvbWlzZSA9IHJlcXVpcmUoJ2JsdWViaXJkJyk7XG5jb25zdCBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5sZXQgZHNlRHJpdmVyO1xudHJ5IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGltcG9ydC9uby1leHRyYW5lb3VzLWRlcGVuZGVuY2llcywgaW1wb3J0L25vLXVucmVzb2x2ZWRcbiAgZHNlRHJpdmVyID0gcmVxdWlyZSgnZHNlLWRyaXZlcicpO1xufSBjYXRjaCAoZSkge1xuICBkc2VEcml2ZXIgPSBudWxsO1xufVxuXG5jb25zdCBjcWwgPSBQcm9taXNlLnByb21pc2lmeUFsbChkc2VEcml2ZXIgfHwgcmVxdWlyZSgnY2Fzc2FuZHJhLWRyaXZlcicpKTtcblxuY29uc3QgT1JNID0gUHJvbWlzZS5wcm9taXNpZnlBbGwocmVxdWlyZSgnLi9vcm0vYXBvbGxvJykpO1xuY29uc3QgcmVhZGRpcnBBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KHJlcXVpcmUoJ3JlYWRkaXJwJykpO1xuY29uc3QgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpKCdleHByZXNzLWNhc3NhbmRyYScpO1xuXG5jb25zdCBleHBvcnRlciA9IHJlcXVpcmUoJy4vdXRpbHMvZXhwb3J0ZXInKTtcbmNvbnN0IGltcG9ydGVyID0gcmVxdWlyZSgnLi91dGlscy9pbXBvcnRlcicpO1xuXG5jb25zdCBDYXNzYW5kcmFDbGllbnQgPSBmdW5jdGlvbiBmKG9wdGlvbnMpIHtcbiAgdGhpcy5tb2RlbEluc3RhbmNlID0ge307XG4gIHRoaXMub3JtID0gbmV3IE9STShvcHRpb25zLmNsaWVudE9wdGlvbnMsIG9wdGlvbnMub3JtT3B0aW9ucyk7XG4gIHRoaXMub3JtID0gUHJvbWlzZS5wcm9taXNpZnlBbGwodGhpcy5vcm0pO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmNyZWF0ZUNsaWVudCA9IChvcHRpb25zKSA9PiAobmV3IENhc3NhbmRyYUNsaWVudChvcHRpb25zKSk7XG5cbkNhc3NhbmRyYUNsaWVudC5zZXREaXJlY3RvcnkgPSAoZGlyZWN0b3J5KSA9PiB7XG4gIENhc3NhbmRyYUNsaWVudC5kaXJlY3RvcnkgPSBkaXJlY3Rvcnk7XG4gIHJldHVybiBDYXNzYW5kcmFDbGllbnQ7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuc3luY01vZGVsRmlsZVRvREIgPSAoZmlsZSwgY2FsbGJhY2spID0+IHtcbiAgaWYgKCFmaWxlLm5hbWUuaW5jbHVkZXMoJ01vZGVsJykpIHtcbiAgICBjYWxsYmFjaygpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IG1vZGVsTmFtZSA9IENhc3NhbmRyYUNsaWVudC5fdHJhbnNsYXRlRmlsZU5hbWVUb01vZGVsTmFtZShmaWxlLm5hbWUpO1xuXG4gIGlmIChtb2RlbE5hbWUpIHtcbiAgICBjb25zdCBmaWxlTG9jYXRpb24gPSBwYXRoLmpvaW4oQ2Fzc2FuZHJhQ2xpZW50LmRpcmVjdG9yeSwgZmlsZS5wYXRoKTtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLWR5bmFtaWMtcmVxdWlyZVxuICAgIGNvbnN0IGRlZmF1bHRNb2RlbFNjaGVtYSA9IHJlcXVpcmUoZmlsZUxvY2F0aW9uKTtcbiAgICBjb25zdCBtb2RlbFNjaGVtYSA9IGRlZmF1bHRNb2RlbFNjaGVtYS5kZWZhdWx0ID8gZGVmYXVsdE1vZGVsU2NoZW1hLmRlZmF1bHQgOiBkZWZhdWx0TW9kZWxTY2hlbWE7XG4gICAgQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXSA9IENhc3NhbmRyYUNsaWVudC5vcm0uYWRkTW9kZWwobW9kZWxOYW1lLnRvTG93ZXJDYXNlKCksIG1vZGVsU2NoZW1hKTtcbiAgICBDYXNzYW5kcmFDbGllbnQubW9kZWxJbnN0YW5jZVttb2RlbE5hbWVdLnN5bmNEQihjYWxsYmFjayk7XG4gICAgQ2Fzc2FuZHJhQ2xpZW50Lm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXSA9IFByb21pc2UucHJvbWlzaWZ5QWxsKENhc3NhbmRyYUNsaWVudC5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNhbGxiYWNrKCk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuYmluZCA9IChvcHRpb25zLCBjYikgPT4ge1xuICBDYXNzYW5kcmFDbGllbnQubW9kZWxJbnN0YW5jZSA9IHt9O1xuICBDYXNzYW5kcmFDbGllbnQub3JtID0gbmV3IE9STShvcHRpb25zLmNsaWVudE9wdGlvbnMsIG9wdGlvbnMub3JtT3B0aW9ucyk7XG4gIENhc3NhbmRyYUNsaWVudC5vcm0gPSBQcm9taXNlLnByb21pc2lmeUFsbChDYXNzYW5kcmFDbGllbnQub3JtKTtcbiAgQ2Fzc2FuZHJhQ2xpZW50Lm9ybS5pbml0QXN5bmMoKVxuICAgIC50aGVuKCgpID0+IHJlYWRkaXJwQXN5bmMoe1xuICAgICAgcm9vdDogQ2Fzc2FuZHJhQ2xpZW50LmRpcmVjdG9yeSxcbiAgICAgIGZpbGVGaWx0ZXI6IFtcbiAgICAgICAgJyouanMnLCAnKi5qYXZhc2NyaXB0JywgJyouanN4JywgJyouY29mZmVlJywgJyouY29mZmVlc2NyaXB0JywgJyouaWNlZCcsXG4gICAgICAgICcqLnNjcmlwdCcsICcqLnRzJywgJyoudHN4JywgJyoudHlwZXNjcmlwdCcsICcqLmNqc3gnLCAnKi5jbycsICcqLmpzb24nLFxuICAgICAgICAnKi5qc29uNScsICcqLmxpdGNvZmZlZScsICcqLmxpdGljZWQnLCAnKi5scycsICcqLm5vZGUnLCAnKi50b21sJyxcbiAgICAgICAgJyoud2lzcCcsICcqLmNqcycsXG4gICAgICBdLFxuICAgIH0pKVxuICAgIC50aGVuKChmaWxlTGlzdCkgPT4ge1xuICAgICAgY29uc3Qgc3luY01vZGVsVGFza3MgPSBbXTtcbiAgICAgIGNvbnN0IHN5bmNNb2RlbEZpbGVUb0RCQXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQuc3luY01vZGVsRmlsZVRvREIpO1xuICAgICAgZmlsZUxpc3QgPSBmaWxlTGlzdC5maWxlcztcbiAgICAgIGZpbGVMaXN0LmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgICAgc3luY01vZGVsVGFza3MucHVzaChzeW5jTW9kZWxGaWxlVG9EQkFzeW5jKGZpbGUpKTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHN5bmNNb2RlbFRhc2tzKTtcbiAgICB9KVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGlmIChjYikgY2IoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBpZiAoY2IgJiYgXy5pc0FycmF5KGVycikgJiYgZXJyLmxlbmd0aCA+IDApIGNiKGVyclswXSk7XG4gICAgICBlbHNlIGlmIChjYikgY2IoZXJyKTtcbiAgICB9KTtcbn07XG5cbkNhc3NhbmRyYUNsaWVudC5iaW5kQXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQuYmluZCk7XG5cbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uIGYoY2FsbGJhY2spIHtcbiAgdGhpcy5vcm0uaW5pdChjYWxsYmFjayk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmluaXRBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUuaW5pdCk7XG5cbkNhc3NhbmRyYUNsaWVudC5nZXRUYWJsZUxpc3QgPSBmdW5jdGlvbiBmKGNhbGxiYWNrKSB7XG4gIGNvbnN0IHN5c3RlbUNsaWVudCA9IHRoaXMub3JtLmdldF9zeXN0ZW1fY2xpZW50KCk7XG4gIGNvbnN0IGtleXNwYWNlID0gdGhpcy5vcm0uZ2V0X2tleXNwYWNlX25hbWUoKTtcbiAgY29uc3QgdGFibGVzID0gW107XG5cbiAgc3lzdGVtQ2xpZW50LmNvbm5lY3QoKVxuICAgIC50aGVuKCgpID0+IHtcbiAgICAgIGNvbnN0IHN5c3RlbVF1ZXJ5ID0gJ1NFTEVDVCB0YWJsZV9uYW1lIEZST00gc3lzdGVtX3NjaGVtYS50YWJsZXMgV0hFUkUga2V5c3BhY2VfbmFtZSA9ID8nO1xuICAgICAgZGVidWcoYEZpbmRpbmcgdGFibGVzIGluIGtleXNwYWNlOiAke2tleXNwYWNlfWApO1xuICAgICAgcmV0dXJuIHN5c3RlbUNsaWVudC5leGVjdXRlKHN5c3RlbVF1ZXJ5LCBba2V5c3BhY2VdKTtcbiAgICB9KVxuICAgIC50aGVuKChyZXN1bHQpID0+IHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0LnJvd3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgdGFibGVzLnB1c2gocmVzdWx0LnJvd3NbaV0udGFibGVfbmFtZSk7XG4gICAgICB9XG4gICAgfSlcbiAgICAudGhlbigoKSA9PiBzeXN0ZW1DbGllbnQuc2h1dGRvd24oKSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBjYWxsYmFjayhudWxsLCB0YWJsZXMpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfSk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuZ2V0VGFibGVMaXN0QXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQuZ2V0VGFibGVMaXN0KTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmV4cG9ydCA9IGZ1bmN0aW9uIGYoZml4dHVyZURpcmVjdG9yeSwgY2FsbGJhY2spIHtcbiAgY29uc3Qgc3lzdGVtQ2xpZW50ID0gdGhpcy5vcm0uZ2V0X3N5c3RlbV9jbGllbnQoKTtcbiAgY29uc3Qga2V5c3BhY2UgPSB0aGlzLm9ybS5nZXRfa2V5c3BhY2VfbmFtZSgpO1xuXG4gIHN5c3RlbUNsaWVudC5jb25uZWN0KClcbiAgICAudGhlbigoKSA9PiB0aGlzLmdldFRhYmxlTGlzdEFzeW5jKCkpXG4gICAgLnRoZW4oKHRhYmxlcykgPT4gUHJvbWlzZS5lYWNoKHRhYmxlcywgKHRhYmxlKSA9PiBleHBvcnRlci5wcm9jZXNzVGFibGVFeHBvcnQoXG4gICAgICBzeXN0ZW1DbGllbnQsXG4gICAgICBmaXh0dXJlRGlyZWN0b3J5LFxuICAgICAga2V5c3BhY2UsXG4gICAgICB0YWJsZSxcbiAgICApKSlcbiAgICAudGhlbigoKSA9PiBzeXN0ZW1DbGllbnQuc2h1dGRvd24oKSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBkZWJ1ZygnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nKTtcbiAgICAgIGRlYnVnKGBDb21wbGV0ZWQgZXhwb3J0aW5nIGFsbCB0YWJsZXMgZnJvbSBrZXlzcGFjZTogJHtrZXlzcGFjZX1gKTtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgZGVidWcoZXJyKTtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfSk7XG59O1xuXG5DYXNzYW5kcmFDbGllbnQuZXhwb3J0QXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQuZXhwb3J0KTtcblxuQ2Fzc2FuZHJhQ2xpZW50LmltcG9ydCA9IGZ1bmN0aW9uIGYoZml4dHVyZURpcmVjdG9yeSwgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG5cbiAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgYmF0Y2hTaXplOiAxLFxuICB9O1xuXG4gIG9wdGlvbnMgPSBfLmRlZmF1bHRzRGVlcCh7fSwgb3B0aW9ucywgZGVmYXVsdHMpO1xuXG4gIGNvbnN0IHN5c3RlbUNsaWVudCA9IHRoaXMub3JtLmdldF9zeXN0ZW1fY2xpZW50KCk7XG4gIGNvbnN0IGtleXNwYWNlID0gdGhpcy5vcm0uZ2V0X2tleXNwYWNlX25hbWUoKTtcblxuICBzeXN0ZW1DbGllbnQuY29ubmVjdCgpXG4gICAgLnRoZW4oKCkgPT4gdGhpcy5nZXRUYWJsZUxpc3RBc3luYygpKVxuICAgIC50aGVuKCh0YWJsZXMpID0+IFByb21pc2UuZWFjaCh0YWJsZXMsICh0YWJsZSkgPT4gaW1wb3J0ZXIucHJvY2Vzc1RhYmxlSW1wb3J0KFxuICAgICAgc3lzdGVtQ2xpZW50LFxuICAgICAgZml4dHVyZURpcmVjdG9yeSxcbiAgICAgIGtleXNwYWNlLFxuICAgICAgdGFibGUsXG4gICAgICBvcHRpb25zLmJhdGNoU2l6ZSxcbiAgICApKSlcbiAgICAudGhlbigoKSA9PiBzeXN0ZW1DbGllbnQuc2h1dGRvd24oKSlcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBkZWJ1ZygnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nKTtcbiAgICAgIGRlYnVnKGBDb21wbGV0ZWQgaW1wb3J0aW5nIHRvIGtleXNwYWNlOiAke2tleXNwYWNlfWApO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBkZWJ1ZyhlcnIpO1xuICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICB9KTtcbn07XG5cbkNhc3NhbmRyYUNsaWVudC5pbXBvcnRBc3luYyA9IFByb21pc2UucHJvbWlzaWZ5KENhc3NhbmRyYUNsaWVudC5pbXBvcnQpO1xuXG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmxvYWRTY2hlbWEgPSBmdW5jdGlvbiBmKG1vZGVsTmFtZSwgbW9kZWxTY2hlbWEpIHtcbiAgdGhpcy5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0gPSB0aGlzLm9ybS5hZGRNb2RlbChtb2RlbE5hbWUsIG1vZGVsU2NoZW1hKTtcbiAgdGhpcy5tb2RlbEluc3RhbmNlW21vZGVsTmFtZV0gPSBQcm9taXNlLnByb21pc2lmeUFsbCh0aGlzLm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXSk7XG4gIHJldHVybiB0aGlzLm1vZGVsSW5zdGFuY2VbbW9kZWxOYW1lXTtcbn07XG5cbkNhc3NhbmRyYUNsaWVudC51dWlkID0gKCkgPT4gKGNxbC50eXBlcy5VdWlkLnJhbmRvbSgpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnV1aWRGcm9tU3RyaW5nID0gKHN0cikgPT4gKGNxbC50eXBlcy5VdWlkLmZyb21TdHJpbmcoc3RyKSk7XG5cbkNhc3NhbmRyYUNsaWVudC51dWlkRnJvbUJ1ZmZlciA9IChidWYpID0+IChuZXcgY3FsLnR5cGVzLlV1aWQoYnVmKSk7XG5cbkNhc3NhbmRyYUNsaWVudC50aW1ldXVpZCA9ICgpID0+IChjcWwudHlwZXMuVGltZVV1aWQubm93KCkpO1xuXG5DYXNzYW5kcmFDbGllbnQudGltZXV1aWRGcm9tRGF0ZSA9IChkYXRlKSA9PiAoY3FsLnR5cGVzLlRpbWVVdWlkLmZyb21EYXRlKGRhdGUpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkRnJvbVN0cmluZyA9IChzdHIpID0+IChjcWwudHlwZXMuVGltZVV1aWQuZnJvbVN0cmluZyhzdHIpKTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkRnJvbUJ1ZmZlciA9IChidWYpID0+IChuZXcgY3FsLnR5cGVzLlRpbWVVdWlkKGJ1ZikpO1xuXG5DYXNzYW5kcmFDbGllbnQubWF4VGltZXV1aWQgPSAoZGF0ZSkgPT4gKGNxbC50eXBlcy5UaW1lVXVpZC5tYXgoZGF0ZSkpO1xuXG5DYXNzYW5kcmFDbGllbnQubWluVGltZXV1aWQgPSAoZGF0ZSkgPT4gKGNxbC50eXBlcy5UaW1lVXVpZC5taW4oZGF0ZSkpO1xuXG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmRvQmF0Y2ggPSBmdW5jdGlvbiBmKHF1ZXJpZXMsIG9wdGlvbnMsIGNhbGxiYWNrKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgY2FsbGJhY2sgPSBvcHRpb25zO1xuICAgIG9wdGlvbnMgPSB7fTtcbiAgfVxuXG4gIGNvbnN0IGRlZmF1bHRzID0ge1xuICAgIHByZXBhcmU6IHRydWUsXG4gIH07XG5cbiAgb3B0aW9ucyA9IF8uZGVmYXVsdHNEZWVwKHt9LCBvcHRpb25zLCBkZWZhdWx0cyk7XG5cbiAgY29uc3QgcmFuZG9tTW9kZWwgPSB0aGlzLm1vZGVsSW5zdGFuY2VbT2JqZWN0LmtleXModGhpcy5tb2RlbEluc3RhbmNlKVswXV07XG4gIGNvbnN0IGJlZm9yZUhvb2tzID0gW107XG5cbiAgbGV0IGJhdGNoUmVzdWx0O1xuICBQcm9taXNlLmFsbChiZWZvcmVIb29rcylcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICBpZiAocXVlcmllcy5sZW5ndGggPiAxKSB7XG4gICAgICAgIHJldHVybiByYW5kb21Nb2RlbC5leGVjdXRlX2JhdGNoQXN5bmMocXVlcmllcywgb3B0aW9ucyk7XG4gICAgICB9XG4gICAgICBpZiAocXVlcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGRlYnVnKCdzaW5nbGUgcXVlcnkgcHJvdmlkZWQgZm9yIGJhdGNoIHJlcXVlc3QsIGFwcGx5aW5nIGFzIG5vbiBiYXRjaCBxdWVyeScpO1xuICAgICAgICByZXR1cm4gcmFuZG9tTW9kZWwuZXhlY3V0ZV9xdWVyeUFzeW5jKHF1ZXJpZXNbMF0ucXVlcnksIHF1ZXJpZXNbMF0ucGFyYW1zLCBvcHRpb25zKTtcbiAgICAgIH1cbiAgICAgIGRlYnVnKCdubyBxdWVyaWVzIHByb3ZpZGVkIGZvciBiYXRjaCByZXF1ZXN0LCBlbXB0eSBhcnJheSBmb3VuZCwgZG9pbmcgbm90aGluZycpO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH0pXG4gICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICBiYXRjaFJlc3VsdCA9IHJlc3BvbnNlO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWVyaWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGFmdGVySG9va1Jlc3BvbnNlID0gcXVlcmllc1tpXS5hZnRlcl9ob29rKCk7XG4gICAgICAgIGlmIChhZnRlckhvb2tSZXNwb25zZSAhPT0gdHJ1ZSkge1xuICAgICAgICAgIGNhbGxiYWNrKGFmdGVySG9va1Jlc3BvbnNlKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNhbGxiYWNrKG51bGwsIGJhdGNoUmVzdWx0KTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjYWxsYmFjayhlcnIpO1xuICAgIH0pO1xufTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS5kb0JhdGNoQXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmRvQmF0Y2gpO1xuXG5DYXNzYW5kcmFDbGllbnQuZG9CYXRjaCA9IGZ1bmN0aW9uIGYocXVlcmllcywgb3B0aW9ucywgY2FsbGJhY2spIHtcbiAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDIpIHtcbiAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgb3B0aW9ucyA9IHt9O1xuICB9XG5cbiAgY29uc3QgZGVmYXVsdHMgPSB7XG4gICAgcHJlcGFyZTogdHJ1ZSxcbiAgfTtcblxuICBvcHRpb25zID0gXy5kZWZhdWx0c0RlZXAoe30sIG9wdGlvbnMsIGRlZmF1bHRzKTtcblxuICBDYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLmRvQmF0Y2guY2FsbChDYXNzYW5kcmFDbGllbnQsIHF1ZXJpZXMsIG9wdGlvbnMsIGNhbGxiYWNrKTtcbn07XG5cbkNhc3NhbmRyYUNsaWVudC5kb0JhdGNoQXN5bmMgPSBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQuZG9CYXRjaCk7XG5cbkNhc3NhbmRyYUNsaWVudC5fdHJhbnNsYXRlRmlsZU5hbWVUb01vZGVsTmFtZSA9IChmaWxlTmFtZSkgPT4gKFxuICBmaWxlTmFtZS5zbGljZSgwLCBmaWxlTmFtZS5sYXN0SW5kZXhPZignLicpKS5yZXBsYWNlKCdNb2RlbCcsICcnKVxuKTtcblxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoQ2Fzc2FuZHJhQ2xpZW50LCB7XG4gIGNvbnNpc3RlbmNpZXM6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsLnR5cGVzLmNvbnNpc3RlbmNpZXM7XG4gICAgfSxcbiAgfSxcbiAgZGF0YXR5cGVzOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIGNxbC50eXBlcztcbiAgICB9LFxuICB9LFxuICBkcml2ZXI6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsO1xuICAgIH0sXG4gIH0sXG4gIGluc3RhbmNlOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIENhc3NhbmRyYUNsaWVudC5tb2RlbEluc3RhbmNlO1xuICAgIH0sXG4gIH0sXG4gIGNsb3NlOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIENhc3NhbmRyYUNsaWVudC5vcm0uY2xvc2U7XG4gICAgfSxcbiAgfSxcbiAgY2xvc2VBc3luYzoge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnByb21pc2lmeShDYXNzYW5kcmFDbGllbnQub3JtLmNsb3NlKTtcbiAgICB9LFxuICB9LFxufSk7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKENhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUsIHtcbiAgY29uc2lzdGVuY2llczoge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiBjcWwudHlwZXMuY29uc2lzdGVuY2llcztcbiAgICB9LFxuICB9LFxuICBkYXRhdHlwZXM6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gY3FsLnR5cGVzO1xuICAgIH0sXG4gIH0sXG4gIGRyaXZlcjoge1xuICAgIGdldCgpIHtcbiAgICAgIHJldHVybiBjcWw7XG4gICAgfSxcbiAgfSxcbiAgaW5zdGFuY2U6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5tb2RlbEluc3RhbmNlO1xuICAgIH0sXG4gIH0sXG4gIGNsb3NlOiB7XG4gICAgZ2V0KCkge1xuICAgICAgcmV0dXJuIHRoaXMub3JtLmNsb3NlO1xuICAgIH0sXG4gIH0sXG4gIGNsb3NlQXN5bmM6IHtcbiAgICBnZXQoKSB7XG4gICAgICByZXR1cm4gUHJvbWlzZS5wcm9taXNpZnkodGhpcy5vcm0uY2xvc2UpO1xuICAgIH0sXG4gIH0sXG59KTtcblxuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS51dWlkID0gQ2Fzc2FuZHJhQ2xpZW50LnV1aWQ7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnV1aWRGcm9tU3RyaW5nID0gQ2Fzc2FuZHJhQ2xpZW50LnV1aWRGcm9tU3RyaW5nO1xuQ2Fzc2FuZHJhQ2xpZW50LnByb3RvdHlwZS51dWlkRnJvbUJ1ZmZlciA9IENhc3NhbmRyYUNsaWVudC51dWlkRnJvbUJ1ZmZlcjtcbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUudGltZXV1aWQgPSBDYXNzYW5kcmFDbGllbnQudGltZXV1aWQ7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLnRpbWV1dWlkRnJvbURhdGUgPSBDYXNzYW5kcmFDbGllbnQudGltZXV1aWRGcm9tRGF0ZTtcbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUudGltZXV1aWRGcm9tU3RyaW5nID0gQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkRnJvbVN0cmluZztcbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUudGltZXV1aWRGcm9tQnVmZmVyID0gQ2Fzc2FuZHJhQ2xpZW50LnRpbWV1dWlkRnJvbUJ1ZmZlcjtcbkNhc3NhbmRyYUNsaWVudC5wcm90b3R5cGUubWF4VGltZXV1aWQgPSBDYXNzYW5kcmFDbGllbnQubWF4VGltZXV1aWQ7XG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLm1pblRpbWV1dWlkID0gQ2Fzc2FuZHJhQ2xpZW50Lm1pblRpbWV1dWlkO1xuXG5DYXNzYW5kcmFDbGllbnQucHJvdG90eXBlLl90cmFuc2xhdGVGaWxlTmFtZVRvTW9kZWxOYW1lID0gQ2Fzc2FuZHJhQ2xpZW50Ll90cmFuc2xhdGVGaWxlTmFtZVRvTW9kZWxOYW1lO1xuXG5tb2R1bGUuZXhwb3J0cyA9IENhc3NhbmRyYUNsaWVudDtcbiJdfQ==